apiVersion: skiperator.kartverket.no/v1alpha1
kind: Application
metadata:
  name: fake-auth
  namespace: obo
spec:
  image: ghcr.io/bekk/obo-flyt/fake-auth:main
  port: 6348
  replicas: 1
  env:
    - name: AUTH_CLIENT_ID
      value: dfb2cec9-3b6d-456b-a14f-649236247e3d
    - name: AUTH_CLIENT_SECRET
      value: secret
    - name: AUTH_SCOPE
      value: api://dfb2cec9-3b6d-456b-a14f-649236247e3d/.default
    - name: AUTH_WELL_KNOWN_URL
      value: https://login.microsoftonline.com/7531b79e-fd42-4826-bff2-131d82c7b557/v2.0/.well-known/openid-configuration
    - name: TOKENDINGS_URL
      value: http://tokendings:7456
  accessPolicy:
    outbound:
      rules:
        - application: tokendings
      external:
        - host: login.microsoftonline.com
    inbound:
      rules:
        - application: tokendings
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app: fake-auth
  name: fake-auth
  namespace: obo
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app: fake-auth
  name: fake-auth
  namespace: obo
rules:
  - apiGroups:
      - "*"
    resources:
      - secrets
    verbs:
      - get
      - watch
      - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app: fake-auth
  name: fake-auth
  namespace: obo
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: fake-auth
subjects:
  - kind: ServiceAccount
    name: fake-auth
    namespace: obo
