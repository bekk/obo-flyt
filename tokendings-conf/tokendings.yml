apiVersion: skiperator.kartverket.no/v1alpha1
kind: Application
metadata:
  name: tokendings
  namespace: obo
spec:
  image: ghcr.io/fredrikmorstad/tokendings/tokendings:latest
  port: 7456
  env:
    - name: DB_HOST
      value: database
    - name: DB_PORT
      value: "5432"
    - name: DB_DATABASE
      value: token-exchange
    - name: DB_USERNAME
      value: user
    - name: DB_PASSWORD
      value: pwd
    - name: DB_JDBC_URL
      value: jdbc:postgresql://database:5432/token-exchange?user=user&password=pwd
    # - name: AUTH_WELL_KNOWN_URL
    #   value: http://tokendings:7456/.well-known/oauth-authorization-server
    # - name: AUTH_WELL_KNOWN_URL
    #   value: http://fake-auth:6348/.well-known/openid-configuration
    - name: AUTH_ACCEPTED_AUDIENCE
      value: http://tokendings:7456/registration/client
    - name: AUTH_CLIENT_JWKS
      value: |
        {"keys":[{"d":"eeetuqrs5k_krasm-towute_mejxtgjsjftzid0v8lz43r-laszhq07overiwlv6grluvkkxq45drh4ymk3yhgscjkapburxknfiwnyq9irzhr04k8ade9sfls3bu1_ig15sfeytzxyvn2dswh6mdf1dtbl8z5xwlmojhdl0ulobleyrvthkg_oqr8dzuruucs8newhtde6xo5o5uapmkdaedkekwf93uqkippv-qga_dff7z5xb90qx8mw5qyaucnaajpw6fufup_vrghfutmpsj0aw1jbfxrazzfwpwgruffuaxbrn-os7gltpn9zd3dfx4gdsms4vpjt7kkk10q","dp":"ovbxzhonw5rv_l5ekke1mfm7wukrjiejd0el4q8fqtfe9znvhac3mimjqsuv4tetnjgfic7f9ttipy25i9dqcdiqdp6kob-7gqeoc8eagngtpi6ogo80wiri7xz-mw4hbmp6uaxqc9kc7aow0zbqmmknwdkxg8kfnqucu29eqve","dq":"zgpzz-mbbemyhlbq4rmqyqa8aqjgbcmwwngyzzlgsusyfyg9pkywlwfvzpoqjzwad4qtigiuow3tc5kukewp7iiwjyuqwpexm3cssek6ag0mctmecehbikfyn8tyopm_tjxmjejoms7bhwy2jnz7iakhx5ylvv2mfa2ehgz_cbu","e":"aqab","kid":"1234","kty":"rsa","n":"vths1ulzpqxypjzqmzrdgupfmt4ar8syl1vflhwzc7bno4fm1vrs0xwarfyyobbk1sxtcc7ojm8ao10nohvyuwxmpr8mcxjwlfnn3xq0d_z7dakht2cjig2eprzloh76qfqucqmihultruiavsobmbe7dhtc63kkoo10i6kqp6ideuqeds7-pyaqjb4f8-kgl9ukdvfo9amwenim0buvnnahdyozoygcmdi1bbtgwoo0rsb1t94lgvvwrplzqulefghzpow-tbrllkhea311borss55rhy8xdyijhnzq-ashpqkroi7velhys6p54339g0z-fkp9uwa8kq2uijpp7q","p":"6zv2jrllyswndmmmqylfnyrw9cgba-aq9cx41qfji8nlllvl_zn1wg8we9bj3la6cabueithzvc40g12tk49hk-91lgmzy1zf6gq2qd5vusi4fehnp_rgwtge2gln_1y1268gpr1dpkjhqpalh3krk7vd3enbtz9wnc7ikew75e","q":"z6oj5v91e1q6erknvrjcj_fqdai88hekleaw16xespfoibbremau6kud4ojbkgce4zp8gx4anzisw6tfoynafqq7hksux87euw9epyfdwmpggtc7k9nmwtoijzduqkal6iebwbzxhphn5sguhri-qejoqa6tsfdfkrak5pm-hp0","qi":"xjfahzfysrwuxhhvtgtwt0uenewkflhw606s4ud5bylsmsdrokatb2kenwuxf9tkixcw35jzafpqbaaeqyn3wz9hsczgv3qqjm_ajt1wn7aih7mg__4dsoqwop95mmzqs9hvfuqyttz8vv9o9pdzzf60cshvqfvvpcfkhukllcm"}]}
    - name: AUTH_CLIENT_ID
      value: dfb2cec9-3b6d-456b-a14f-649236247e3d
    - name: ISSUER_URL
      value: http://fake-auth:6348
    - name: SUBJECT_TOKEN_ISSUERS
      value: http://fake-auth:6348/.well-known/openid-configuration/
    - name: APPLICATION_PORT
      value: "7456"
  replicas: 1
  accessPolicy:
    outbound:
      rules:
        - application: fake-auth
        - application: database
      external:
        - host: login.microsoftonline.com
    inbound:
      rules:
        - application: fake-auth
        - application: database
        - application: jwker
